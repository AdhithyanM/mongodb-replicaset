version: "1.0.0"
services:
  mongo_primary:
    image: mongo
    ports:
      - "27017:27017"
    command: mongod --replSet "rs0"
    environment:
      - MONGO_INITDB_REPLICASET=rs0
    restart: always
    networks:
      - mongo_replica
    volumes:
      - ./data/primary:/data/db
    depends_on:
      - "mongo_secondary-1"
      - "mongo_secondary-2"

  mongo_secondary-1:
    image: mongo
    command: mongod --replSet "rs0"
    ports:
      - "27018:27107"
    environment:
      - MONGO_INITDB_REPLICASET=rs0
    restart: always
    networks:
      - mongo_replica
    volumes:
      - ./data/secondary-1:/data/db

  mongo_secondary-2:
    image: mongo
    command: mongod --replSet "rs0"
    ports:
      - "27019:27017"
    environment:
      - MONGO_INITDB_REPLICASET=rs0
    restart: always
    networks:
      - mongo_replica
    volumes:
      - ./data/secondary-2:/data/db

  setup-rs:
    image: "mongo-rs-setup"
    build: ./setup
    networks:
      - mongo_replica
    depends_on:
      - "mongo_primary"

volumes:
  mongo_primary:
  mongo_secondary-1:
  mongo_secondary-2:

networks:
  mongo_replica:
    driver: bridge
